{"ast":null,"code":"import _objectSpread from\"/home/fernando/Documentos/MobilityProject/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/home/fernando/Documentos/MobilityProject/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/fernando/Documentos/MobilityProject/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/fernando/Documentos/MobilityProject/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/fernando/Documentos/MobilityProject/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/fernando/Documentos/MobilityProject/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from'react';import{Redirect}from'react-router-dom';import{connect}from'react-redux';import{logoutUser}from'../../actions/authActions';import{postCheckIn,updateCheckout,updatePayment}from'../../actions/clientActions';import ClientNav from'./ClientNav';import MapContainer from'../MapAux/MapContainer';import PlacesAutocomplete,{geocodeByAddress,getLatLng}from'react-places-autocomplete';import{Button,Icon,Row,Col,Card}from'react-materialize';import Typography from'@material-ui/core/Typography';import{typo}from'../Contants/constants/typo';var Checkout=/*#__PURE__*/function(_Component){_inherits(Checkout,_Component);function Checkout(props){var _this;_classCallCheck(this,Checkout);_this=_possibleConstructorReturn(this,_getPrototypeOf(Checkout).call(this,props));_this.handleChange=function(address){_this.setState({address:address});};_this.handleSelect=function(address){_this.setState({address:address});geocodeByAddress(address).then(function(results){return getLatLng(results[0]);}).then(function(latLng){_this.setState({lat:latLng.lat,lng:latLng.lng,canRender:true});}).catch(function(error){return console.error('Error',error);});};_this.checkoutNow=function(e){e.preventDefault();var checkout={id:_this.props.clients.checkin._id,vehicle:_this.props.clients.checkin.vehicle,lat:_this.state.lat,lon:_this.state.lng,address:_this.state.address};_this.props.updateCheckout(checkout.id,checkout.vehicle,checkout.lat,checkout.lon,checkout.address);//checkout\n/* setTimeout(() => {\n      this.setState({\n        checkout: this.props.clients.checkin.checkout\n      });\n    }, 100); */setTimeout(function(){_this.setState({checkout:_this.props.clients.checkin.checkout,rentalMethod:_this.props.clients.checkout.rentalMethod,previewCost:_this.props.clients.checkout.previewCost,timeSpent:_this.props.clients.checkout.timeSpent,hasDiscount:_this.props.clients.checkout.hasDiscount});},500);};_this.updatePayment=function(e){e.preventDefault();//checkout\n/* this.setState(prevState => {\n      return {\n        checkout: this.props.checkin.checkin.checkout\n      };\n    }); */ //user\nvar payment={id:_this.props.clients.checkout._id};_this.props.updatePayment(payment.id);//checkout\nsetTimeout(function(){_this.setState({finalCost:_this.props.clients.payment.finalCost});},1000);//this.props.payment.payment.finalCost\n//this.props.checkout.checkout.rentalMethod\n//this.props.checkout.checkout.previewCost\n//this.props.checkout.checkout.timeSpent\n};_this.redirectNow=function(){/* this.setState(prevState => ({\n      disabled: !prevState.disabled\n    })); */setInterval(function(){_this.setState({//disabled: !this.state.disabled,\ncount:_this.state.count-1});},2000);return React.createElement(\"div\",null,React.createElement(\"div\",null,\"Refreshing in \",_this.state.count),_this.state.count!==0?'':React.createElement(\"div\",null,React.createElement(Redirect,{to:'/balance',state:_this.props.clients.isCheckIn===false})));};_this.getCoords=function(){var firstCenter=_this.props.places.places.map(function(place){return{lat:place.center[0],lng:place.center[1]};});var coords=_objectSpread({},firstCenter[0]);return coords;};_this.state={address:'',lat:'',lng:'',value:'',canRender:false,checkout:false,hasPayment:false,payment:'',finalCost:0,count:3,disabled:false,rentalMethod:'',timeSpent:0,previewCost:0,hasDiscount:true};return _this;}_createClass(Checkout,[{key:\"render\",value:function render(){var style={height:'400px',width:'100%'};/* const firstCenter = this.props.places.places.map(place => {\n      return {\n        lat: place.center[0],\n        lng: place.center[1]\n      };\n    }); */var initialCenter=this.getCoords();var position={lat:this.state.lat,lng:this.state.lng};var paths=[{lat:41.53113384600326,lng:-8.619018495082855},{lat:41.53113384600326,lng:-8.61851692199707},{lat:41.53129447698251,lng:-8.61851692199707},{lat:41.53129447698251,lng:-8.619018495082855},{lat:41.53113384600326,lng:-8.619018495082855}];var lat=this.state.lat;var lng=this.state.lng;var center={lat:41.53113384600326,lng:-8.619018495082855};if(this.state.lat!==''&&this.state.lng!==''){center={lat:lat,lng:lng};}return React.createElement(\"div\",null,React.createElement(ClientNav,null),React.createElement(\"div\",{style:{textAlign:'center'}},React.createElement(\"h3\",{className:\"flow-text grey-text text-darken-1\"},\"Checkout your location please!\")),React.createElement(\"div\",{className:\"container valign-wrapper\"},React.createElement(\"div\",{className:\"row center-align s12\"},React.createElement(\"div\",{className:\"col\"},React.createElement(PlacesAutocomplete,{value:this.state.address,onChange:this.handleChange,onSelect:this.handleSelect},function(_ref){var getInputProps=_ref.getInputProps,suggestions=_ref.suggestions,getSuggestionItemProps=_ref.getSuggestionItemProps,loading=_ref.loading;return React.createElement(\"div\",null,React.createElement(\"input\",getInputProps({placeholder:'Search Places ...',className:'location-search-input'})),React.createElement(\"div\",{className:\"autocomplete-dropdown-container\"},loading&&React.createElement(\"div\",null,\"Loading...\"),suggestions.map(function(suggestion){var className=suggestion.active?'suggestion-item--active':'suggestion-item';// inline style for demonstration purpose\nvar style=suggestion.active?{backgroundColor:'#fafafa',cursor:'pointer'}:{backgroundColor:'#ffffff',cursor:'pointer'};return React.createElement(\"div\",getSuggestionItemProps(suggestion,{className:className,style:style}),React.createElement(\"span\",null,suggestion.description));})));})))),React.createElement(\"div\",{style:{textAlign:'center'}},React.createElement(Button,{node:\"button\",type:\"submit\",onClick:this.checkoutNow,disabled:this.state.disabled},\"Checkout\",React.createElement(Icon,{right:true},\"send\")),this.props.clients.checkout.checkout&&!this.props.clients.checkout.paymentComplete?React.createElement(\"div\",null,React.createElement(Row,{key:0},React.createElement(Col,{m:12,s:12},React.createElement(Card,{actions:[React.createElement(Button,{node:\"button\",type:\"submit\",onClick:this.updatePayment,disabled:this.state.disabled},\"Pay now!\",React.createElement(Icon,{right:true},\"send\"))],className:\"blue-grey darken-1\",closeicon:React.createElement(Icon,null,\"close\"),revealicon:React.createElement(Icon,null,\"more_vert\"),textClassName:\"white-text\",title:\"Your payment data\"},React.createElement(\"div\",null,React.createElement(\"p\",null,React.createElement(\"label\",null,\"Payment Method: \"),React.createElement(\"strong\",null,React.createElement(\"span\",null,this.state.rentalMethod))),React.createElement(\"p\",null,React.createElement(\"label\",null,\"Preview Cost: \"),React.createElement(\"strong\",null,React.createElement(\"span\",null,\"\".concat(this.state.previewCost,\"\\u20AC\")))),React.createElement(\"p\",null,React.createElement(\"label\",null,\"Time Spent: \"),React.createElement(\"strong\",null,React.createElement(\"span\",null,this.state.timeSpent)))))))):React.createElement(\"div\",null,\"You still havent checked out!\")),this.state.finalCost>0?React.createElement(\"div\",{style:{textAlign:'center'}},React.createElement(Typography,{className:typo.root,variant:\"h6\",gutterBottom:true},this.state.hasDiscount?React.createElement(\"div\",null,\"Discount applied for valid Park.\"):React.createElement(\"div\",null,\"No discount\"),React.createElement(\"div\",null,\"Payment of \".concat(this.state.finalCost,\"\\u20AC Successful!\")),React.createElement(\"div\",null,this.redirectNow()))):React.createElement(Typography,{className:typo.root,variant:\"h6\",gutterBottom:true},React.createElement(\"div\",{style:{textAlign:'center'}},\"No payment has been made\")),React.createElement(\"div\",{className:\"m12\"},React.createElement(MapContainer,{initialCenter:initialCenter,position:position,paths:paths,style:style,center:center})));}}]);return Checkout;}(Component);var mapStateToProps=function mapStateToProps(state){return{auth:state.auth,places:state.places,checkin:state.checkin,checkout:state.checkout,payment:state.payment,clients:state.clients};};export default connect(mapStateToProps,{logoutUser:logoutUser,postCheckIn:postCheckIn,updateCheckout:updateCheckout,updatePayment:updatePayment})(Checkout);","map":{"version":3,"sources":["/home/fernando/Documentos/MobilityProject/client/src/components/Clients/Checkout.js"],"names":["React","Component","Redirect","connect","logoutUser","postCheckIn","updateCheckout","updatePayment","ClientNav","MapContainer","PlacesAutocomplete","geocodeByAddress","getLatLng","Button","Icon","Row","Col","Card","Typography","typo","Checkout","props","handleChange","address","setState","handleSelect","then","results","latLng","lat","lng","canRender","catch","error","console","checkoutNow","e","preventDefault","checkout","id","clients","checkin","_id","vehicle","state","lon","setTimeout","rentalMethod","previewCost","timeSpent","hasDiscount","payment","finalCost","redirectNow","setInterval","count","isCheckIn","getCoords","firstCenter","places","map","place","center","coords","value","hasPayment","disabled","style","height","width","initialCenter","position","paths","textAlign","getInputProps","suggestions","getSuggestionItemProps","loading","placeholder","className","suggestion","active","backgroundColor","cursor","description","paymentComplete","root","mapStateToProps","auth"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { Redirect } from 'react-router-dom';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { logoutUser } from '../../actions/authActions';\nimport {\n  postCheckIn,\n  updateCheckout,\n  updatePayment\n} from '../../actions/clientActions';\n\nimport ClientNav from './ClientNav';\nimport MapContainer from '../MapAux/MapContainer';\nimport PlacesAutocomplete, {\n  geocodeByAddress,\n  getLatLng\n} from 'react-places-autocomplete';\nimport { Button, Icon, Row, Col, Card } from 'react-materialize';\nimport Typography from '@material-ui/core/Typography';\nimport { typo } from '../Contants/constants/typo';\n\nclass Checkout extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      address: '',\n      lat: '',\n      lng: '',\n      value: '',\n      canRender: false,\n      checkout: false,\n      hasPayment: false,\n      payment: '',\n      finalCost: 0,\n      count: 3,\n      disabled: false,\n      rentalMethod: '',\n      timeSpent: 0,\n      previewCost: 0,\n      hasDiscount: true\n    };\n  }\n\n  handleChange = address => {\n    this.setState({ address });\n  };\n\n  handleSelect = address => {\n    this.setState({ address });\n    geocodeByAddress(address)\n      .then(results => getLatLng(results[0]))\n      .then(latLng => {\n        this.setState({\n          lat: latLng.lat,\n          lng: latLng.lng,\n          canRender: true\n        });\n      })\n      .catch(error => console.error('Error', error));\n  };\n\n  checkoutNow = e => {\n    e.preventDefault();\n\n    const checkout = {\n      id: this.props.clients.checkin._id,\n      vehicle: this.props.clients.checkin.vehicle,\n      lat: this.state.lat,\n      lon: this.state.lng,\n      address: this.state.address\n    };\n\n    this.props.updateCheckout(\n      checkout.id,\n      checkout.vehicle,\n      checkout.lat,\n      checkout.lon,\n      checkout.address\n    );\n\n    //checkout\n    /* setTimeout(() => {\n      this.setState({\n        checkout: this.props.clients.checkin.checkout\n      });\n    }, 100); */\n\n    setTimeout(() => {\n      this.setState({\n        checkout: this.props.clients.checkin.checkout,\n        rentalMethod: this.props.clients.checkout.rentalMethod,\n        previewCost: this.props.clients.checkout.previewCost,\n        timeSpent: this.props.clients.checkout.timeSpent,\n        hasDiscount: this.props.clients.checkout.hasDiscount\n      });\n    }, 500);\n  };\n\n  updatePayment = e => {\n    e.preventDefault();\n\n    //checkout\n    /* this.setState(prevState => {\n      return {\n        checkout: this.props.checkin.checkin.checkout\n      };\n    }); */\n    //user\n    const payment = {\n      id: this.props.clients.checkout._id\n    };\n\n    this.props.updatePayment(payment.id);\n\n    //checkout\n    setTimeout(() => {\n      this.setState({\n        finalCost: this.props.clients.payment.finalCost\n      });\n    }, 1000);\n\n    //this.props.payment.payment.finalCost\n    //this.props.checkout.checkout.rentalMethod\n    //this.props.checkout.checkout.previewCost\n    //this.props.checkout.checkout.timeSpent\n  };\n\n  redirectNow = () => {\n    /* this.setState(prevState => ({\n      disabled: !prevState.disabled\n    })); */\n    setInterval(() => {\n      this.setState({\n        //disabled: !this.state.disabled,\n        count: this.state.count - 1\n      });\n    }, 2000);\n    return (\n      <div>\n        <div>Refreshing in {this.state.count}</div>\n        {this.state.count !== 0 ? (\n          ''\n        ) : (\n          <div>\n            {/* <Redirect\n              to={'/balance'}\n              state={this.props.checkin.isCheckIn === false}\n              /> */}\n            <Redirect\n              to={'/balance'}\n              state={this.props.clients.isCheckIn === false}\n            />\n          </div>\n        )}\n      </div>\n    );\n  };\n\n  getCoords = () => {\n    const firstCenter = this.props.places.places.map(place => {\n      return {\n        lat: place.center[0],\n        lng: place.center[1]\n      };\n    });\n    let coords = { ...firstCenter[0] };\n    return coords;\n  };\n\n  render() {\n    const style = {\n      height: '400px',\n      width: '100%'\n    };\n\n    /* const firstCenter = this.props.places.places.map(place => {\n      return {\n        lat: place.center[0],\n        lng: place.center[1]\n      };\n    }); */\n\n    const initialCenter = this.getCoords();\n    const position = {\n      lat: this.state.lat,\n      lng: this.state.lng\n    };\n    const paths = [\n      { lat: 41.53113384600326, lng: -8.619018495082855 },\n      { lat: 41.53113384600326, lng: -8.61851692199707 },\n      { lat: 41.53129447698251, lng: -8.61851692199707 },\n      { lat: 41.53129447698251, lng: -8.619018495082855 },\n      { lat: 41.53113384600326, lng: -8.619018495082855 }\n    ];\n    let lat = this.state.lat;\n    let lng = this.state.lng;\n    let center = { lat: 41.53113384600326, lng: -8.619018495082855 };\n\n    if (this.state.lat !== '' && this.state.lng !== '') {\n      center = { lat, lng };\n    }\n\n    return (\n      <div>\n        <ClientNav />\n        <div style={{ textAlign: 'center' }}>\n          <h3 className='flow-text grey-text text-darken-1'>\n            Checkout your location please!\n          </h3>\n        </div>\n        <div className='container valign-wrapper'>\n          <div className='row center-align s12'>\n            <div className='col'>\n              <PlacesAutocomplete\n                value={this.state.address}\n                onChange={this.handleChange}\n                onSelect={this.handleSelect}\n              >\n                {({\n                  getInputProps,\n                  suggestions,\n                  getSuggestionItemProps,\n                  loading\n                }) => (\n                  <div>\n                    <input\n                      {...getInputProps({\n                        placeholder: 'Search Places ...',\n                        className: 'location-search-input'\n                      })}\n                    />\n                    <div className='autocomplete-dropdown-container'>\n                      {loading && <div>Loading...</div>}\n                      {suggestions.map(suggestion => {\n                        const className = suggestion.active\n                          ? 'suggestion-item--active'\n                          : 'suggestion-item';\n                        // inline style for demonstration purpose\n                        const style = suggestion.active\n                          ? { backgroundColor: '#fafafa', cursor: 'pointer' }\n                          : { backgroundColor: '#ffffff', cursor: 'pointer' };\n                        return (\n                          <div\n                            {...getSuggestionItemProps(suggestion, {\n                              className,\n                              style\n                            })}\n                          >\n                            <span>{suggestion.description}</span>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  </div>\n                )}\n              </PlacesAutocomplete>\n            </div>\n          </div>\n        </div>\n        <div style={{ textAlign: 'center' }}>\n          <Button\n            node='button'\n            type='submit'\n            onClick={this.checkoutNow}\n            disabled={this.state.disabled}\n          >\n            Checkout\n            <Icon right>send</Icon>\n          </Button>\n\n          {this.props.clients.checkout.checkout &&\n          !this.props.clients.checkout.paymentComplete ? (\n            <div>\n              <Row key={0}>\n                <Col m={12} s={12}>\n                  <Card\n                    actions={[\n                      <Button\n                        node='button'\n                        type='submit'\n                        onClick={this.updatePayment}\n                        disabled={this.state.disabled}\n                      >\n                        Pay now!\n                        <Icon right>send</Icon>\n                      </Button>\n                    ]}\n                    className='blue-grey darken-1'\n                    closeicon={<Icon>close</Icon>}\n                    revealicon={<Icon>more_vert</Icon>}\n                    textClassName='white-text'\n                    title='Your payment data'\n                  >\n                    {\n                      <div>\n                        <p>\n                          <label>Payment Method: </label>\n                          <strong>\n                            <span>{this.state.rentalMethod}</span>\n                          </strong>\n                        </p>\n                        <p>\n                          <label>Preview Cost: </label>\n                          <strong>\n                            <span>{`${this.state.previewCost}€`}</span>\n                          </strong>\n                        </p>\n                        <p>\n                          <label>Time Spent: </label>\n                          <strong>\n                            <span>{this.state.timeSpent}</span>\n                          </strong>\n                        </p>\n                      </div>\n                    }\n                  </Card>\n                </Col>\n              </Row>\n            </div>\n          ) : (\n            <div>You still havent checked out!</div>\n          )}\n        </div>\n\n        {this.state.finalCost > 0 ? (\n          <div style={{ textAlign: 'center' }}>\n            <Typography className={typo.root} variant='h6' gutterBottom>\n              {this.state.hasDiscount ? (\n                <div>Discount applied for valid Park.</div>\n              ) : (\n                <div>No discount</div>\n              )}\n              <div>{`Payment of ${this.state.finalCost}€ Successful!`}</div>\n\n              <div>{this.redirectNow()}</div>\n            </Typography>\n          </div>\n        ) : (\n          <Typography className={typo.root} variant='h6' gutterBottom>\n            <div style={{ textAlign: 'center' }}>No payment has been made</div>\n          </Typography>\n        )}\n\n        <div className='m12'>\n          <MapContainer\n            initialCenter={initialCenter}\n            position={position}\n            paths={paths}\n            style={style}\n            center={center}\n          />\n        </div>\n      </div>\n    );\n  }\n}\nCheckout.propTypes = {\n  logoutUser: PropTypes.func.isRequired,\n  auth: PropTypes.object.isRequired,\n  postCheckIn: PropTypes.func.isRequired,\n  updateCheckout: PropTypes.func.isRequired,\n  updatePayment: PropTypes.func.isRequired\n};\nconst mapStateToProps = state => ({\n  auth: state.auth,\n  places: state.places,\n  checkin: state.checkin,\n  checkout: state.checkout,\n  payment: state.payment,\n  clients: state.clients\n});\n\nexport default connect(mapStateToProps, {\n  logoutUser,\n  postCheckIn,\n  updateCheckout,\n  updatePayment\n})(Checkout);\n"]},"metadata":{},"sourceType":"module"}