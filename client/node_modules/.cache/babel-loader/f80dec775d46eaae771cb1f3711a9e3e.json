{"ast":null,"code":"import _objectSpread from\"/home/fernando/Documentos/MobilityProject/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/home/fernando/Documentos/MobilityProject/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _possibleConstructorReturn from\"/home/fernando/Documentos/MobilityProject/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/fernando/Documentos/MobilityProject/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/home/fernando/Documentos/MobilityProject/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _createClass from\"/home/fernando/Documentos/MobilityProject/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/fernando/Documentos/MobilityProject/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from'react';import{NavLink,Link}from'react-router-dom';import{connect}from'react-redux';import{logoutUser}from'../../actions/authActions';import{getVehicles,getRentalMethods,postCheckIn,getConsult,getNotifiedUser}from'../../actions/clientActions';import Dropdown from'react-dropdown';import'react-dropdown/style.css';import ClientNav from'./ClientNav';import{Button,Icon}from'react-materialize';import ReactNotification from'react-notifications-component';import'react-notifications-component/dist/theme.css';import{store}from'react-notifications-component';import'@material/react-snackbar/dist/snackbar.css';import{Snackbar}from'@material/react-snackbar';//const options = ['one', 'two', 'three'];\n//const rental = ['minutes', 'pack'];\nvar Checkin=/*#__PURE__*/function(_Component){_inherits(Checkin,_Component);_createClass(Checkin,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.props.getVehicles();this.props.getRentalMethods();this.props.getNotifiedUser(this.props.auth.user._id);this.timer=setInterval(function(){return _this2.getNotification();},2000);navigator.geolocation.getCurrentPosition(function(position){_this2.setState({lat:position.coords.latitude,lon:position.coords.longitude});});}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){clearInterval(this.timer);this.timer=null;// here...\n}}]);function Checkin(props){var _this;_classCallCheck(this,Checkin);_this=_possibleConstructorReturn(this,_getPrototypeOf(Checkin).call(this,props));_this.getNotification=function(){var notified=_this.props.clients.notifiedUser.notified;if(notified){return React.createElement(\"div\",{className:\"app-container\"},React.createElement(ReactNotification,null),store.addNotification({title:'Wrong Parking!',message:'Your vehicle is in the wrong place',type:'warning',insert:'top',container:'top-right',animationIn:['animated','zoomIn'],animationOut:['animated','zoomOut'],dismiss:{duration:1000,onScreen:true}}));}};_this.onSubmit=function(e){e.preventDefault();var checkin={user:_this.props.auth.user._id,id:_this.state.vehicle.value,rentalMethod:_this.state.rentalMethod.value,lat:JSON.stringify(_this.state.lat),lon:JSON.stringify(_this.state.lon)};_this.props.postCheckIn(checkin.user,checkin.id,checkin.rentalMethod,checkin.lat,checkin.lon);_this.setState(function(prevState){return{disabled:!prevState.disabled,checkin:!prevState.checkin};});_this.props.clients.isCheckIn=!_this.props.clients.isCheckIn;};_this.onConsult=function(e){e.preventDefault();_this.props.getConsult(_this.props.clients.checkin._id);setTimeout(function(){_this.setState(function(prevState){return{canRender:!prevState.canRender};});},100);};_this.state={vehicle:'',rentalMethod:'',lat:'',lon:'',disabled:false,checkin:false,price:'',previewCost:'',timeSpent:'',canRender:false};_this._onSelect=_this._onSelect.bind(_assertThisInitialized(_this));_this._onMethodSelect=_this._onMethodSelect.bind(_assertThisInitialized(_this));return _this;}_createClass(Checkin,[{key:\"_onSelect\",value:function _onSelect(option){this.setState({vehicle:option});}},{key:\"_onMethodSelect\",value:function _onMethodSelect(value){this.setState({rentalMethod:value});}},{key:\"render\",value:function render(){var user=this.props.auth.user;var vehicles=this.props.clients.vehicles;var methods=this.props.clients.methods;var rental=methods;var getAvailables=vehicles.filter(function(vechicle){return vechicle.available===true;});var defaultVehicleOption=this.state.vehicle;var defaultMethodOption=this.state.rentalMethod;var placeHolderVehicleValue=typeof this.state.vehicle==='string'?this.state.vehicle:this.state.vehicle.label;var placeHolderRentalValue=typeof this.state.rentalMethod==='string'?this.state.rentalMethod:this.state.rentalMethod.label;return React.createElement(React.Fragment,null,React.createElement(ClientNav,null),React.createElement(\"div\",{style:{textAlign:'center'}},React.createElement(\"p\",{className:\"flow-text grey-text text-darken-1\"},\"Hello \",user.username,\"! Checkin with us now!\"),React.createElement(\"div\",{className:\"row\"},React.createElement(\"section\",null,React.createElement(\"p\",{className:\"flow-text grey-text text-darken-1\"},\"Pick your Vehicle\"),React.createElement(\"div\",{className:\"col s6\"},React.createElement(Dropdown,{options:getAvailables.map(function(available){return available._id;}),onChange:this._onSelect,value:defaultVehicleOption,placeholder:\"Select an option\",disabled:this.state.disabled})),React.createElement(\"div\",{className:\"col s6 result\"},\"Your vehicle\",React.createElement(\"strong\",null,\" \",placeHolderVehicleValue,\" \")))),React.createElement(\"div\",{className:\"row\"},React.createElement(\"section\",null,React.createElement(\"h5\",{className:\"flow-text grey-text text-darken-1\"},\"Pick your rental method\"),React.createElement(\"div\",{className:\"col s6\"},React.createElement(Dropdown,{options:rental,onChange:this._onMethodSelect,value:defaultMethodOption,placeholder:\"Select an option\",disabled:this.state.disabled})),React.createElement(\"div\",{className:\"result col s6\"},\"Your Rental Method\",React.createElement(\"strong\",null,\" \",placeHolderRentalValue,\" \")))),React.createElement(\"section\",null,React.createElement(\"div\",{className:\"center-align\"},React.createElement(Button,{node:\"button\",type:\"submit\",onClick:this.onSubmit,disabled:this.state.disabled},\"Checkin\",React.createElement(Icon,{right:true},\"send\")),this.getNotification())),React.createElement(\"div\",{className:\"flow-text grey-text text-darken-2\"},this.state.checkin?React.createElement(\"div\",null,React.createElement(Snackbar,{message:\"You are checked!\",actionText:\"x\"}),React.createElement(Button,{node:\"button\",type:\"submit\",onClick:this.onConsult},\"Check your time estimative!\",React.createElement(Icon,{right:true},\"send\")),this.state.canRender?React.createElement(\"section\",null,React.createElement(\"div\",null,React.createElement(\"span\",null,\"Base price is:\",' ',React.createElement(\"strong\",null,this.props.clients.consult.price))),React.createElement(\"div\",null,React.createElement(\"span\",null,\"Your preview cost is:\",' ',React.createElement(\"strong\",null,this.props.clients.consult.previewCost))),React.createElement(\"div\",null,React.createElement(\"span\",null,\"Time spend:\",' ',React.createElement(\"strong\",null,this.props.clients.consult.timeSpent))),React.createElement(NavLink,{to:{pathname:'/checkout',state:_objectSpread({},this.props.clients.consult)}},React.createElement(Button,{node:\"button\",type:\"submit\"},\"Checkout\",React.createElement(Icon,{right:true},\"send\"))),this.props.clients.consult.paymentComplete?React.createElement(Link,{to:\"/checkout\"},\"Payment incomplete. Click here to redirect!\"):''):''):React.createElement(Snackbar,{message:\"You are not checked in!\",actionText:\"x\"}))));}}]);return Checkin;}(Component);var mapStateToProps=function mapStateToProps(state){return{auth:state.auth,vehicles:state.vehicles,methods:state.methods,checkin:state.checkin,consult:state.consult,clients:state.clients,notifiedUser:state.notifiedUser};};export default connect(mapStateToProps,{logoutUser:logoutUser,getVehicles:getVehicles,getRentalMethods:getRentalMethods,postCheckIn:postCheckIn,getConsult:getConsult,getNotifiedUser:getNotifiedUser})(Checkin);","map":{"version":3,"sources":["/home/fernando/Documentos/MobilityProject/client/src/components/Clients/Checkin.js"],"names":["React","Component","NavLink","Link","connect","logoutUser","getVehicles","getRentalMethods","postCheckIn","getConsult","getNotifiedUser","Dropdown","ClientNav","Button","Icon","ReactNotification","store","Snackbar","Checkin","props","auth","user","_id","timer","setInterval","getNotification","navigator","geolocation","getCurrentPosition","position","setState","lat","coords","latitude","lon","longitude","clearInterval","notified","clients","notifiedUser","addNotification","title","message","type","insert","container","animationIn","animationOut","dismiss","duration","onScreen","onSubmit","e","preventDefault","checkin","id","state","vehicle","value","rentalMethod","JSON","stringify","prevState","disabled","isCheckIn","onConsult","setTimeout","canRender","price","previewCost","timeSpent","_onSelect","bind","_onMethodSelect","option","vehicles","methods","rental","getAvailables","filter","vechicle","available","defaultVehicleOption","defaultMethodOption","placeHolderVehicleValue","label","placeHolderRentalValue","textAlign","username","map","consult","pathname","paymentComplete","mapStateToProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { NavLink, Link } from 'react-router-dom';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { logoutUser } from '../../actions/authActions';\nimport {\n  getVehicles,\n  getRentalMethods,\n  postCheckIn,\n  getConsult,\n  getNotifiedUser\n} from '../../actions/clientActions';\nimport Dropdown from 'react-dropdown';\nimport 'react-dropdown/style.css';\nimport ClientNav from './ClientNav';\nimport { Button, Icon } from 'react-materialize';\nimport ReactNotification from 'react-notifications-component';\nimport 'react-notifications-component/dist/theme.css';\nimport { store } from 'react-notifications-component';\nimport '@material/react-snackbar/dist/snackbar.css';\nimport { Snackbar } from '@material/react-snackbar';\n\n//const options = ['one', 'two', 'three'];\n//const rental = ['minutes', 'pack'];\nclass Checkin extends Component {\n  componentDidMount() {\n    this.props.getVehicles();\n    this.props.getRentalMethods();\n    this.props.getNotifiedUser(this.props.auth.user._id);\n    this.timer = setInterval(() => this.getNotification(), 2000);\n    navigator.geolocation.getCurrentPosition(position => {\n      this.setState({\n        lat: position.coords.latitude,\n        lon: position.coords.longitude\n      });\n    });\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.timer);\n    this.timer = null; // here...\n  }\n\n  getNotification = () => {\n    const notified = this.props.clients.notifiedUser.notified;\n    if (notified) {\n      return (\n        <div className='app-container'>\n          <ReactNotification />\n          {store.addNotification({\n            title: 'Wrong Parking!',\n            message: 'Your vehicle is in the wrong place',\n            type: 'warning',\n            insert: 'top',\n            container: 'top-right',\n            animationIn: ['animated', 'zoomIn'],\n            animationOut: ['animated', 'zoomOut'],\n            dismiss: {\n              duration: 1000,\n              onScreen: true\n            }\n          })}\n        </div>\n      );\n    }\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      vehicle: '',\n      rentalMethod: '',\n      lat: '',\n      lon: '',\n      disabled: false,\n      checkin: false,\n      price: '',\n      previewCost: '',\n      timeSpent: '',\n      canRender: false\n    };\n    this._onSelect = this._onSelect.bind(this);\n    this._onMethodSelect = this._onMethodSelect.bind(this);\n  }\n\n  _onSelect(option) {\n    this.setState({ vehicle: option });\n  }\n\n  _onMethodSelect(value) {\n    this.setState({ rentalMethod: value });\n  }\n\n  onSubmit = e => {\n    e.preventDefault();\n\n    const checkin = {\n      user: this.props.auth.user._id,\n      id: this.state.vehicle.value,\n      rentalMethod: this.state.rentalMethod.value,\n      lat: JSON.stringify(this.state.lat),\n      lon: JSON.stringify(this.state.lon)\n    };\n\n    this.props.postCheckIn(\n      checkin.user,\n      checkin.id,\n      checkin.rentalMethod,\n      checkin.lat,\n      checkin.lon\n    );\n\n    this.setState(prevState => ({\n      disabled: !prevState.disabled,\n      checkin: !prevState.checkin\n    }));\n\n    this.props.clients.isCheckIn = !this.props.clients.isCheckIn;\n  };\n\n  onConsult = e => {\n    e.preventDefault();\n\n    this.props.getConsult(this.props.clients.checkin._id);\n\n    setTimeout(() => {\n      this.setState(prevState => ({\n        canRender: !prevState.canRender\n      }));\n    }, 100);\n  };\n\n  render() {\n    const { user } = this.props.auth;\n    const { vehicles } = this.props.clients;\n    const { methods } = this.props.clients;\n    const rental = methods;\n    const getAvailables = vehicles.filter(\n      vechicle => vechicle.available === true\n    );\n\n    const defaultVehicleOption = this.state.vehicle;\n    const defaultMethodOption = this.state.rentalMethod;\n\n    const placeHolderVehicleValue =\n      typeof this.state.vehicle === 'string'\n        ? this.state.vehicle\n        : this.state.vehicle.label;\n\n    const placeHolderRentalValue =\n      typeof this.state.rentalMethod === 'string'\n        ? this.state.rentalMethod\n        : this.state.rentalMethod.label;\n    return (\n      <>\n        <ClientNav />\n        <div style={{ textAlign: 'center' }}>\n          <p className='flow-text grey-text text-darken-1'>\n            Hello {user.username}! Checkin with us now!\n          </p>\n\n          <div className='row'>\n            <section>\n              <p className='flow-text grey-text text-darken-1'>\n                Pick your Vehicle\n              </p>\n              <div className='col s6'>\n                <Dropdown\n                  options={getAvailables.map(available => available._id)}\n                  onChange={this._onSelect}\n                  value={defaultVehicleOption}\n                  placeholder='Select an option'\n                  disabled={this.state.disabled}\n                />\n              </div>\n              <div className='col s6 result'>\n                Your vehicle\n                <strong> {placeHolderVehicleValue} </strong>\n              </div>\n            </section>\n          </div>\n          <div className='row'>\n            <section>\n              <h5 className='flow-text grey-text text-darken-1'>\n                Pick your rental method\n              </h5>\n              <div className='col s6'>\n                <Dropdown\n                  options={rental}\n                  onChange={this._onMethodSelect}\n                  value={defaultMethodOption}\n                  placeholder='Select an option'\n                  disabled={this.state.disabled}\n                />\n              </div>\n              <div className='result col s6'>\n                Your Rental Method\n                <strong> {placeHolderRentalValue} </strong>\n              </div>\n            </section>\n          </div>\n          <section>\n            <div className='center-align'>\n              <Button\n                node='button'\n                type='submit'\n                onClick={this.onSubmit}\n                disabled={this.state.disabled}\n              >\n                Checkin\n                <Icon right>send</Icon>\n              </Button>\n              {this.getNotification()}\n            </div>\n          </section>\n          <div className='flow-text grey-text text-darken-2'>\n            {this.state.checkin ? (\n              <div>\n                <Snackbar message='You are checked!' actionText='x' />\n\n                <Button node='button' type='submit' onClick={this.onConsult}>\n                  Check your time estimative!\n                  <Icon right>send</Icon>\n                </Button>\n                {this.state.canRender ? (\n                  <section>\n                    <div>\n                      <span>\n                        Base price is:{' '}\n                        <strong>{this.props.clients.consult.price}</strong>\n                      </span>\n                    </div>\n                    <div>\n                      <span>\n                        Your preview cost is:{' '}\n                        <strong>\n                          {this.props.clients.consult.previewCost}\n                        </strong>\n                      </span>\n                    </div>\n                    <div>\n                      <span>\n                        Time spend:{' '}\n                        <strong>{this.props.clients.consult.timeSpent}</strong>\n                      </span>\n                    </div>\n                    <NavLink\n                      to={{\n                        pathname: '/checkout',\n                        state: { ...this.props.clients.consult }\n                      }}\n                    >\n                      <Button node='button' type='submit'>\n                        Checkout\n                        <Icon right>send</Icon>\n                      </Button>\n                    </NavLink>\n                    {this.props.clients.consult.paymentComplete ? (\n                      <Link to='/checkout'>\n                        Payment incomplete. Click here to redirect!\n                      </Link>\n                    ) : (\n                      ''\n                    )}\n                  </section>\n                ) : (\n                  ''\n                )}\n              </div>\n            ) : (\n              <Snackbar message='You are not checked in!' actionText='x' />\n            )}\n          </div>\n        </div>\n      </>\n    );\n  }\n}\n\nCheckin.propTypes = {\n  logoutUser: PropTypes.func.isRequired,\n  auth: PropTypes.object.isRequired,\n  checkin: PropTypes.object.isRequired,\n  getVehicles: PropTypes.func.isRequired,\n  getRentalMethods: PropTypes.func.isRequired,\n  postCheckIn: PropTypes.func.isRequired,\n  getConsult: PropTypes.func.isRequired,\n  getNotifiedUser: PropTypes.func.isRequired\n};\nconst mapStateToProps = state => ({\n  auth: state.auth,\n  vehicles: state.vehicles,\n  methods: state.methods,\n  checkin: state.checkin,\n  consult: state.consult,\n  clients: state.clients,\n  notifiedUser: state.notifiedUser\n});\n\nexport default connect(mapStateToProps, {\n  logoutUser,\n  getVehicles,\n  getRentalMethods,\n  postCheckIn,\n  getConsult,\n  getNotifiedUser\n})(Checkin);\n"]},"metadata":{},"sourceType":"module"}